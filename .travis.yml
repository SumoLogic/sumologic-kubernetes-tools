os: linux
# Somehow focal (20.04) is available for amd64 but when
# ran on travis it falls back to xenial (16.04).
dist: bionic
arch: amd64
language: shell

jobs:
  include:
    - stage: shellcheck build.sh
      install:
        - sudo apt update
        - sudo apt install shellcheck
      script:
        # SC2154 - Don't warn about undeclared variables that we take from travis environment.
        - shellcheck --norc --enable all --exclude SC2154 ci/build.sh

    - stage: build
      language: ruby
      # TODO: upgrade this?
      dist: trusty
      services: docker
      script:
        - bash ci/build.sh
      branches:
        only:
          - master
          - /^release-v\d+\.\d+$/
          - /^v\d+\.\d+\.\d+$/
          - /^v\d+\.\d+\.\d+-(alpha|beta|rc)\.\d+$/
